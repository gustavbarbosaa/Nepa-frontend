<app-table-list-items [data]="projects()">
  <ng-template #headerTable>
    <tr>
      <th style="width: 25%">Título</th>
      <th style="width: 25%">Titulação</th>
      <th style="width: 20%">Status</th>
      <th style="width: 5%">Vagas</th>
      <th style="width: 25%">Limite de edição</th>
      <th style="width: 5%">Ações</th>
    </tr>
  </ng-template>

  <ng-template #bodyTable let-project>
    <tr>
      <td>
        <div
          class="max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ project.titulo }}
        </div>
      </td>

      <td>
        <div
          class="max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ project.titulacao }}
        </div>
      </td>

      <td>
        @switch (project.status) {
          @case ('Pendente') {
            <p-tag value="Pendente" severity="warning" />
          }
          @case ('Em Andamento') {
            <p-tag value="Em Andamento" severity="info" />
          }
          @case ('Concluído') {
            <p-tag value="Concluído" severity="success" />
          }
          @case ('Cancelado') {
            <p-tag value="Cancelado" severity="danger" />
          }
          @case ('Aprovado') {
            <p-tag value="Aprovado" severity="success" />
          }
          @default {
            <p-tag value="Desconhecido" severity="secondary" />
          }
        }
      </td>

      <td>
        <div
          class="max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ project.vagas_ocupadas }} / {{ project.vagas_totais }}
        </div>
      </td>

      <td>
        <div
          class="flex items-center justify-center max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ project.data_limite_edicao | date: 'dd/MM/yyy' }}
        </div>
      </td>

      @if (userInfo() && userInfo()!.autoridade === autoridade.admin) {
        <td>
          <div class="flex items-center gap-2">
            @if (project.status === statusProjeto.pendente) {
              <p-button
                icon="pi pi-check"
                (onClick)="showApproveDialog(project)"
                severity="success" />
            } @else {
              <p-button
                icon="pi pi-sync"
                (onClick)="showApproveDialog(project)"
                severity="info" />
            }
            <p-dialog
              header="Alerta!"
              [(visible)]="visibleApprove"
              [modal]="true"
              [dismissableMask]="true"
              [style]="{ width: '650px' }"
              [breakpoints]="{ '960px': '90vw' }"
              appendTo="body">
              <p-toast position="top-right" />

              <div>
                @if (selectedProject()) {
                  <h2
                    class="text-xl font-bold text-success-600 py-4 border-t border-tertiary-200">
                    @if (selectedProject()!.status === statusProjeto.pendente) {
                      Tem certeza que deseja aprovar este projeto?
                    } @else {
                      Tem certeza que deseja alterar o status deste projeto?
                    }
                  </h2>
                  <p class="mb-2">
                    <strong>Título:</strong> {{ selectedProject()!.titulo }}
                  </p>
                  <p class="mb-4">
                    <strong>Descrição:</strong>
                    {{ selectedProject()!.titulacao }}
                  </p>
                  <p class="mb-4">
                    <app-select-form
                      id="status"
                      label="Selecione o status"
                      initialIcon="heroAdjustmentsHorizontal"
                      [control]="getControl('status')"
                      [options]="statusProject()" />
                  </p>
                  <div
                    class="flex justify-end gap-4 pt-6 border-t border-tertiary-200">
                    <button
                      type="button"
                      class="bg-tertiary-200 px-4 py-2 rounded-lg cursor-pointer hover:bg-tertiary-300 transition-all"
                      (click)="visibleApprove.set(false)">
                      Cancelar
                    </button>

                    <app-button
                      [text]="
                        selectedProject()!.status === statusProjeto.pendente
                          ? 'Aprovar'
                          : 'Alterar Status'
                      "
                      color="bg-success-600"
                      class="text-light max-w-[150px] w-full"
                      (click)="approveProject()"
                      [loading]="loading()" />
                  </div>
                }
              </div>
            </p-dialog>
            <p-button
              icon="pi pi-trash"
              (onClick)="showDeleteDialog(project)"
              severity="danger" />
            <p-dialog
              header="Alertaa!"
              [(visible)]="visibleDelete"
              [modal]="true"
              [dismissableMask]="true"
              [style]="{ width: '500px' }"
              [breakpoints]="{ '960px': '90vw' }"
              appendTo="body">
              <p-toast position="top-right" />

              <div>
                @if (selectedProject()) {
                  <h2
                    class="text-xl font-bold text-danger-600 py-4 border-t border-tertiary-200">
                    Tem certeza que deseja excluir este projeto?
                  </h2>
                  <p class="mb-2">
                    <strong>Título:</strong> {{ selectedProject()!.titulo }}
                  </p>
                  <p class="mb-4">
                    <strong>Descrição:</strong>
                    {{ selectedProject()!.titulacao }}
                  </p>
                  <div
                    class="flex justify-end gap-4 pt-6 border-t border-tertiary-200">
                    <button
                      type="button"
                      class="bg-tertiary-200 px-4 py-2 rounded-lg cursor-pointer hover:bg-tertiary-300 transition-all"
                      (click)="visibleDelete.set(false)">
                      Cancelar
                    </button>

                    <app-button
                      text="Excluir"
                      color="bg-danger-600"
                      class="text-light max-w-[150px] w-full"
                      (click)="deleteProject()"
                      [loading]="loading()" />
                  </div>
                }
              </div>
            </p-dialog>
          </div>
        </td>
      } @else if (userInfo() && userInfo()!.autoridade === autoridade.aluno) {
        <td>
          <div class="flex items-center gap-2">
            @if (!project.subscriptionStatus) {
              <p-button
                icon="pi pi-user-plus"
                pTooltip="Realizar inscrição"
                [disabled]="
                  project.vagas_ocupadas >= project.vagas_totais ||
                  project.status !== 'Em Andamento'
                "
                (onClick)="showSubscriptionDialog(project)"
                severity="info" />
            } @else {
              @switch (project.subscriptionStatus) {
                @case (statusInscricao.APROVADO) {
                  <p-button
                    icon="pi pi-check"
                    severity="success"
                    [disabled]="true"
                    pTooltip="Sua inscrição foi aprovada" />
                }
                @case (statusInscricao.PENDENTE) {
                  <p-button
                    icon="pi pi-clock"
                    severity="warn"
                    [disabled]="true"
                    pTooltip="Sua inscrição está pendente de aprovação" />
                }
                @case (statusInscricao.REJEITADO) {
                  <p-button
                    icon="pi pi-times"
                    severity="danger"
                    [disabled]="true"
                    pTooltip="Sua inscrição foi rejeitada" />
                }
              }
            }
            <p-dialog
              header="Alerta!"
              [(visible)]="visibleSubscription"
              [modal]="true"
              [dismissableMask]="true"
              [style]="{ width: '500px' }"
              [breakpoints]="{ '960px': '90vw' }"
              appendTo="body">
              <p-toast position="top-right" />

              <div>
                @if (selectedProject()) {
                  <h2
                    class="text-xl font-bold text-primary-600 py-4 border-t border-tertiary-200">
                    Tem certeza que deseja se inscrever neste projeto?
                  </h2>
                  <p class="mb-2">
                    <strong>Título:</strong> {{ selectedProject()!.titulo }}
                  </p>
                  <p class="mb-4">
                    <strong>Descrição:</strong>
                    {{ selectedProject()!.titulacao }}
                  </p>
                  <div
                    class="flex justify-end gap-4 pt-6 border-t border-tertiary-200">
                    <button
                      type="button"
                      class="bg-tertiary-200 px-4 py-2 rounded-lg cursor-pointer hover:bg-tertiary-300 transition-all"
                      (click)="visibleSubscription.set(false)">
                      Cancelar
                    </button>

                    <app-button
                      text="Inscrever-se"
                      color="bg-primary-600"
                      class="text-light max-w-[150px] w-full"
                      (click)="subscribeInProject()"
                      [loading]="loading()" />
                  </div>
                }
              </div>
            </p-dialog>
          </div>
        </td>
      }
    </tr>
  </ng-template>
</app-table-list-items>
