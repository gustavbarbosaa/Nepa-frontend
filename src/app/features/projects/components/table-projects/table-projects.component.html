<app-table-list-items [data]="projects()">
  <ng-template #headerTable>
    <tr>
      <th style="width: 25%">Título</th>
      <th style="width: 25%">Titulação</th>
      <th style="width: 20%">Status</th>
      <th style="width: 5%">Vagas</th>
      <th style="width: 25%">Limite de edição</th>
      <th style="width: 5%">Ações</th>
    </tr>
  </ng-template>

  <ng-template #bodyTable let-project>
    <tr>
      <td>
        <div
          class="max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ project.titulo }}
        </div>
      </td>

      <td>
        <div
          class="max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ project.titulacao }}
        </div>
      </td>

      <td>
        @switch (project.status) {
          @case ('Pendente') {
            <p-tag value="Pendente" severity="warning" />
          }
          @case ('Em Andamento') {
            <p-tag value="Em Andamento" severity="info" />
          }
          @case ('Concluído') {
            <p-tag value="Concluído" severity="success" />
          }
          @case ('Cancelado') {
            <p-tag value="Cancelado" severity="danger" />
          }
          @default {
            <p-tag value="Desconhecido" severity="secondary" />
          }
        }
      </td>

      <td>
        <div
          class="max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ project.vagas_ocupadas }} / {{ project.vagas_totais }}
        </div>
      </td>

      <td>
        <div
          class="flex items-center justify-center max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ project.data_limite_edicao | date: 'dd/MM/yyy' }}
        </div>
      </td>

      <td>
        <div class="flex items-center gap-2">
          <p-button
            icon="pi pi-check"
            (onClick)="showApproveDialog(project)"
            severity="success" />
          <p-dialog
            header="Alerta!"
            [(visible)]="visibleApprove"
            [modal]="true"
            [dismissableMask]="true"
            [style]="{ width: '500px' }"
            [breakpoints]="{ '960px': '90vw' }"
            appendTo="body">
            <p-toast position="top-right" />

            <div>
              @if (selectedProject()) {
                <h2
                  class="text-xl font-bold text-success-600 py-4 border-t border-tertiary-200">
                  Tem certeza que deseja aprovar este projeto?
                </h2>
                <p class="mb-2">
                  <strong>Título:</strong> {{ selectedProject()!.titulo }}
                </p>
                <p class="mb-4">
                  <strong>Descrição:</strong>
                  {{ selectedProject()!.titulacao }}
                </p>
                <p class="mb-4">
                  <app-select-form
                    id="status"
                    label="Selecione o status"
                    initialIcon="heroAdjustmentsHorizontal"
                    [control]="getControl('status')"
                    [options]="statusProject()" />
                </p>
                <div
                  class="flex justify-end gap-4 pt-6 border-t border-tertiary-200">
                  <button
                    type="button"
                    class="bg-tertiary-200 px-4 py-2 rounded-lg cursor-pointer hover:bg-tertiary-300 transition-all"
                    (click)="visibleApprove.set(false)">
                    Cancelar
                  </button>

                  <app-button
                    text="Aprovar"
                    color="bg-success-600"
                    class="text-light max-w-[150px] w-full"
                    (click)="approveProject()"
                    [loading]="loading()" />
                </div>
              }
            </div>
          </p-dialog>
          <p-button
            icon="pi pi-trash"
            (onClick)="showDeleteDialog(project)"
            severity="danger" />
          <p-dialog
            header="Alertaa!"
            [(visible)]="visibleDelete"
            [modal]="true"
            [dismissableMask]="true"
            [style]="{ width: '500px' }"
            [breakpoints]="{ '960px': '90vw' }"
            appendTo="body">
            <p-toast position="top-right" />

            <div>
              @if (selectedProject()) {
                <h2
                  class="text-xl font-bold text-danger-600 py-4 border-t border-tertiary-200">
                  Tem certeza que deseja excluir este projeto?
                </h2>
                <p class="mb-2">
                  <strong>Título:</strong> {{ selectedProject()!.titulo }}
                </p>
                <p class="mb-4">
                  <strong>Descrição:</strong>
                  {{ selectedProject()!.titulacao }}
                </p>
                <div
                  class="flex justify-end gap-4 pt-6 border-t border-tertiary-200">
                  <button
                    type="button"
                    class="bg-tertiary-200 px-4 py-2 rounded-lg cursor-pointer hover:bg-tertiary-300 transition-all"
                    (click)="visibleDelete.set(false)">
                    Cancelar
                  </button>

                  <app-button
                    text="Excluir"
                    color="bg-danger-600"
                    class="text-light max-w-[150px] w-full"
                    (click)="deleteProject()"
                    [loading]="loading()" />
                </div>
              }
            </div>
          </p-dialog>
        </div>
      </td>
    </tr>
  </ng-template>
</app-table-list-items>
