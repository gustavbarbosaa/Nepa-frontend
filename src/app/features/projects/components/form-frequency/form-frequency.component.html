<p-toast />
<p-dialog
  header="Realizar frequência"
  [(visible)]="visible"
  (onHide)="visibleChange.emit(false)"
  modal="true"
  [style]="{ width: '50rem' }">
  <p-tabs [(value)]="activeTab" scrollable class="w-full">
    <p-tablist>
      @for (freq of frequencias.controls; let i = $index; track i) {
        <p-tab [value]="i">Semana {{ i + 1 }}</p-tab>
      }
      <p-tab [value]="frequencias.controls.length">
        <p-button icon="pi pi-plus" rounded="true" (onClick)="addSemana()" />
      </p-tab>
    </p-tablist>

    <p-tabpanels>
      @for (semana of frequencias.controls; let i = $index; track i) {
        <p-tabpanel [value]="i">
          <div class="w-full flex flex-col items-center justify-center gap-4">
            <app-input-form
              class="w-full"
              [id]="'data_sem' + i"
              label="Data da atividade"
              type="date"
              initialIcon="heroCalendarDateRange"
              [control]="getControl(i, 'realizada_em')"
              placeholder="Insira a data da frequência" />

            <div class="w-full flex justify-center items-center gap-2">
              <app-input-form
                initialIcon="heroClock"
                class="flex-1"
                [id]="'inicio_sem' + i"
                label="Início da atividade"
                type="time"
                [control]="getControl(i, 'tempo_inicio')"
                placeholder="Informe a hora que a reunião iniciou" />

              <app-input-form
                initialIcon="heroClock"
                class="flex-1"
                [id]="'termino_sem' + i"
                label="Término da atividade"
                type="time"
                [control]="getControl(i, 'tempo_termino')"
                placeholder="Informe a hora que a reunião terminou" />
            </div>

            <app-text-area
              class="w-full"
              [id]="'descricao_sem' + i"
              label="Descrição"
              [control]="getControl(i, 'descricao')"
              placeholder="Insira uma descrição" />

            <app-text-area
              class="w-full"
              [id]="'observacao_sem' + i"
              label="Observação"
              [control]="getControl(i, 'observacao')"
              placeholder="Insira uma observação" />
          </div>

          <!-- Lista de alunos -->
          <div
            class="w-full mt-4 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
            <h3
              class="font-bold p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-lg text-gray-800 dark:text-gray-200">
              Alunos
            </h3>

            <div
              class="divide-y divide-gray-200 dark:divide-gray-700 max-h-[450px] overflow-y-auto">
              @for (
                alunoCtrl of getAlunosArray(i).controls;
                track alunoCtrl.value.inscricao_id
              ) {
                <label
                  [for]="'aluno-checkbox-' + alunoCtrl.value.inscricao_id"
                  class="flex items-center gap-3 p-4 cursor-pointer transition-colors duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                  <p-checkbox
                    [inputId]="'aluno-checkbox-' + alunoCtrl.value.inscricao_id"
                    [binary]="true"
                    [formControl]="getFormControl(alunoCtrl.get('presente'))"
                    class="shrink-0" />
                  <span class="text-gray-700 dark:text-gray-300">
                    {{ alunoCtrl.value.nome }}
                  </span>
                </label>
              }
            </div>
          </div>
        </p-tabpanel>
      }
    </p-tabpanels>
  </p-tabs>

  <!-- Footer de ações -->
  <div class="w-full flex justify-end gap-2 mt-4">
    <p-button label="Cancelar" severity="secondary" (click)="closeDialog()" />
    <p-button
      label="Cadastrar frequência"
      icon="pi pi-plus"
      (click)="submit()" />
  </div>
</p-dialog>
