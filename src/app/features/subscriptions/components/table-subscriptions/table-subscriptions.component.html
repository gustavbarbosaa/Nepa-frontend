<app-table-list-items [loading]="loading()" [data]="subscriptions()">
  <ng-template #headerTable>
    <tr>
      <th style="width: 25%">Aluno</th>
      <th style="width: 25%">Email</th>
      <th style="width: 20%">Bolsista</th>
      <th style="width: 25%">Status</th>
      <th style="width: 25%">Ações</th>
    </tr>
  </ng-template>
  <ng-template #bodyTable let-subscription>
    <tr>
      <td>
        <div
          class="flex flex-col max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          <p>
            {{ subscription.aluno.nome }}
          </p>
          <small>
            {{ subscription.aluno.matricula }}
          </small>
        </div>
      </td>

      <td>
        <div
          class="max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ subscription.aluno.email }}
        </div>
      </td>

      <td>
        <div
          class="max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          @if (subscription.bolsista) {
            <p-tag severity="secondary" value="Bolsista" />
          } @else {
            <p-tag severity="info" value="Participante" />
          }
        </div>
      </td>

      <td>
        <div
          class="max-w-[350px] truncate whitespace-nowrap overflow-hidden text-ellipsis">
          {{ subscription.status }}
        </div>
      </td>

      <td>
        <div class="flex items-center gap-2">
          <p-button
            icon="pi pi-check"
            severity="success"
            [disabled]="subscription.status"
            (onClick)="showApproveDialog(subscription)" />

          <p-dialog
            header="Alerta!"
            [(visible)]="visibleApprove"
            [modal]="true"
            [dismissableMask]="true"
            [style]="{ width: '500px' }"
            [breakpoints]="{ '960px': '90vw' }"
            appendTo="body">
            <p-toast position="top-right" />

            <div>
              @if (subscriptionSelected()) {
                <h2
                  class="text-xl font-bold text-success-600 py-4 border-t border-tertiary-200">
                  Tem certeza que deseja aprovar este aluno?
                </h2>
                <p class="mb-2 flex flex-col">
                  <strong
                    >Nome: {{ subscriptionSelected()!.aluno.nome }}</strong
                  >
                  <small
                    >Matrícula:
                    {{ subscriptionSelected()!.aluno.matricula }}</small
                  >
                </p>
                <div
                  class="flex justify-end gap-4 pt-6 border-t border-tertiary-200">
                  <button
                    type="button"
                    class="bg-tertiary-200 px-4 py-2 rounded-lg cursor-pointer hover:bg-tertiary-300 transition-all"
                    (click)="visibleApprove.set(false)">
                    Cancelar
                  </button>

                  <app-button
                    text="Aprovar"
                    color="bg-success-600"
                    class="text-light max-w-[150px] w-full"
                    (click)="approveSubscription()"
                    [loading]="loading()" />
                </div>
              }
            </div>
          </p-dialog>

          <p-button
            icon="pi pi-trash"
            severity="danger"
            (onClick)="showRepproveDialog(subscription)" />

          <p-dialog
            header="Alerta!"
            [(visible)]="visibleRepprove"
            [modal]="true"
            [dismissableMask]="true"
            [style]="{ width: '500px' }"
            [breakpoints]="{ '960px': '90vw' }"
            appendTo="body">
            <p-toast position="top-right" />

            <div>
              @if (subscriptionSelected()) {
                <h2
                  class="text-xl font-bold text-danger-600 py-4 border-t border-tertiary-200">
                  Tem certeza que deseja reprovar este aluno?
                </h2>
                <p class="mb-2 flex flex-col">
                  <strong
                    >Nome: {{ subscriptionSelected()!.aluno.nome }}</strong
                  >
                  <small
                    >Matrícula:
                    {{ subscriptionSelected()!.aluno.matricula }}</small
                  >
                </p>
                <div
                  class="flex justify-end gap-4 pt-6 border-t border-tertiary-200">
                  <button
                    type="button"
                    class="bg-tertiary-200 px-4 py-2 rounded-lg cursor-pointer hover:bg-tertiary-300 transition-all"
                    (click)="visibleRepprove.set(false)">
                    Cancelar
                  </button>

                  <app-button
                    text="Reprovar"
                    color="bg-danger-600"
                    class="text-light max-w-[150px] w-full"
                    (click)="repproveSubscription()"
                    [loading]="loading()" />
                </div>
              }
            </div>
          </p-dialog>
        </div>
      </td>
    </tr>
  </ng-template>
</app-table-list-items>
